<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器 - huluobuo.github.io</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <meta name="description" content="在线音乐播放器 - 聆听精选音乐">
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">
    <header class="header">
        <div class="header-content">
            <a href="/">
                <h1>huluobuo.github.io</h1>
            </a>
            <a href="https://github.com/huluobuo" target="_blank" rel="noopener noreferrer" class="tooltip" data-tooltip="访问我的GitHub">
                <img src="../img/github_logo.png" alt="GitHub" width="32" height="32">
            </a>
        </div>
    </header>

    <main class="content" style="flex: 1;">
        <section class="music-section" id="music-section">
            <h2><i class="ri-music-line" style="margin-right: 0.5rem;"></i>音乐播放器</h2>
            <p style="margin-bottom: 2rem; color: var(--gray-600);">精选音乐合集，点击任意歌曲开始播放。</p>
            
            <div class="player-controls" style="background: var(--gray-100); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 2rem;">
                <div class="now-playing" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div class="album-art" style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center;">
                        <i class="ri-music-2-line" style="font-size: 1.5rem; color: white;"></i>
                    </div>
                    <div class="track-info" style="flex: 1;">
                        <div id="current-track" style="font-weight: 600; color: var(--gray-800);">选择一首歌曲开始播放</div>
                        <div id="current-artist" style="color: var(--gray-600); font-size: 0.875rem;">huluobuo 音乐合集</div>
                    </div>
                    <div class="playback-controls" style="display: flex; gap: 0.5rem;">
                        <button id="prev-btn" class="control-btn" style="width: 40px; height: 40px; border: none; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow-sm);">
                            <i class="ri-skip-back-line"></i>
                        </button>
                        <button id="play-pause-btn" class="control-btn" style="width: 50px; height: 50px; border: none; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow-md);">
                            <i class="ri-play-line"></i>
                        </button>
                        <button id="next-btn" class="control-btn" style="width: 40px; height: 40px; border: none; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow-sm);">
                            <i class="ri-skip-forward-line"></i>
                        </button>
                    </div>
                </div>
                
                <div class="progress-container" style="margin-bottom: 1rem;">
                    <div class="progress-bar" style="width: 100%; height: 6px; background: var(--gray-300); border-radius: 3px; cursor: pointer; position: relative;">
                        <div id="progress-fill" style="height: 100%; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); border-radius: 3px; width: 0%; transition: width 0.1s ease;"></div>
                    </div>
                    <div class="time-display" style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>
                </div>
                
                <div class="volume-container" style="display: flex; align-items: center; gap: 1rem;">
                    <i class="ri-volume-down-line" style="color: var(--gray-600);"></i>
                    <input type="range" id="volume-slider" min="0" max="100" value="70" 
                           style="flex: 1; height: 6px; background: var(--gray-300); border-radius: 3px; outline: none; cursor: pointer;">
                    <i class="ri-volume-up-line" style="color: var(--gray-600);"></i>
                </div>
            </div>

            <div class="music-stats" style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color: white; padding: 1rem; border-radius: var(--border-radius); flex: 1; min-width: 120px;">
                    <div style="font-size: 1.5rem; font-weight: 700;" id="total-tracks">0</div>
                    <div style="font-size: 0.875rem; opacity: 0.9;">总曲目</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary-color), var(--primary-color)); color: white; padding: 1rem; border-radius: var(--border-radius); flex: 1; min-width: 120px;">
                    <div style="font-size: 1.5rem; font-weight: 700;" id="total-duration">0:00</div>
                    <div style="font-size: 0.875rem; opacity: 0.9;">总时长</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--accent-color), var(--secondary-color)); color: white; padding: 1rem; border-radius: var(--border-radius); flex: 1; min-width: 120px;">
                    <div style="font-size: 1.5rem; font-weight: 700;" id="current-index">-</div>
                    <div style="font-size: 0.875rem; opacity: 0.9;">当前曲目</div>
                </div>
            </div>
            
            <div class="links-container" id="music-container">
                <div class="loading-placeholder" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                    <div class="loading" style="margin: 0 auto 1rem;"></div>
                    <p>正在加载音乐列表...</p>
                </div>
            </div>
        </section>
    </main>

    <audio id="audio-player" preload="metadata" style="display: none;"></audio>

    <script>
        class MusicPlayer {
            constructor() {
                this.playlist = [];
                this.currentIndex = -1;
                this.isPlaying = false;
                this.audio = document.getElementById('audio-player');
                this.init();
            }

            async init() {
                await this.loadPlaylist();
                this.setupEventListeners();
                this.updateStats();
                this.triggerAnimations();
            }

            async loadPlaylist() {
                try {
                    const response = await fetch('./musiclist.json');
                    if (!response.ok) throw new Error('Failed to load playlist');
                    
                    this.playlist = await response.json();
                    this.renderPlaylist();
                } catch (error) {
                    console.error('加载音乐列表时出错:', error);
                    this.showError('无法加载音乐列表，请稍后重试。');
                }
            }

            renderPlaylist() {
                const container = document.getElementById('music-container');
                
                if (this.playlist.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                            <i class="ri-music-line" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <p style="color: var(--gray-600);">暂无音乐文件</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.playlist.map((track, index) => `
                    <div class="link-box music-item" 
                         data-index="${index}"
                         style="cursor: pointer; animation-delay: ${index * 0.1}s; position: relative;">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <div class="track-number" style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-weight: 600;">
                                ${index + 1}
                            </div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0; font-size: 1.1rem; line-height: 1.3;">${track.name}</h3>
                                <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.25rem;">
                                    <span>${this.formatTime(track.time_big * 60)}</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: auto;">
                            <span style="font-size: 0.875rem; opacity: 0.8;">点击播放</span>
                            <i class="ri-play-line play-icon" style="font-size: 1.25rem;"></i>
                        </div>
                        <div class="playing-indicator" style="position: absolute; top: 1rem; right: 1rem; display: none;">
                            <div style="display: flex; gap: 2px; align-items: end; height: 16px;">
                                <div style="width: 3px; background: white; animation: musicBar 1s ease-in-out infinite; animation-delay: 0s;"></div>
                                <div style="width: 3px; background: white; animation: musicBar 1s ease-in-out infinite; animation-delay: 0.2s;"></div>
                                <div style="width: 3px; background: white; animation: musicBar 1s ease-in-out infinite; animation-delay: 0.4s;"></div>
                            </div>
                        </div>
                    </div>
                `).join('');

                // 添加音乐条动画
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes musicBar {
                        0%, 100% { height: 4px; }
                        50% { height: 16px; }
                    }
                `;
                document.head.appendChild(style);

                this.addPlaylistEvents();
            }

            addPlaylistEvents() {
                document.querySelectorAll('.music-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const index = parseInt(item.dataset.index);
                        this.playTrack(index);
                    });
                });
            }

            setupEventListeners() {
                // 播放/暂停按钮
                document.getElementById('play-pause-btn').addEventListener('click', () => {
                    this.togglePlayPause();
                });

                // 上一首/下一首
                document.getElementById('prev-btn').addEventListener('click', () => {
                    this.previousTrack();
                });

                document.getElementById('next-btn').addEventListener('click', () => {
                    this.nextTrack();
                });

                // 音量控制
                document.getElementById('volume-slider').addEventListener('input', (e) => {
                    this.audio.volume = e.target.value / 100;
                });

                // 进度条控制
                document.querySelector('.progress-bar').addEventListener('click', (e) => {
                    const rect = e.target.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    this.audio.currentTime = percent * this.audio.duration;
                });

                // 音频事件
                this.audio.addEventListener('loadedmetadata', () => {
                    document.getElementById('total-time').textContent = this.formatTime(this.audio.duration);
                });

                this.audio.addEventListener('timeupdate', () => {
                    this.updateProgress();
                });

                this.audio.addEventListener('ended', () => {
                    this.nextTrack();
                });

                this.audio.addEventListener('error', (e) => {
                    console.error('音频播放错误:', e);
                    this.showMessage('播放出错，正在尝试下一首...', 'error');
                    setTimeout(() => this.nextTrack(), 2000);
                });

                // 键盘快捷键
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT') return;
                    
                    switch(e.code) {
                        case 'Space':
                            e.preventDefault();
                            this.togglePlayPause();
                            break;
                        case 'ArrowLeft':
                            this.previousTrack();
                            break;
                        case 'ArrowRight':
                            this.nextTrack();
                            break;
                    }
                });
            }

            playTrack(index) {
                if (index < 0 || index >= this.playlist.length) return;

                this.currentIndex = index;
                const track = this.playlist[index];
                
                // 更新UI
                this.updateNowPlaying(track);
                this.updatePlaylistUI();
                
                // 加载并播放音频
                this.audio.src = track.path;
                this.audio.load();
                
                this.audio.play().then(() => {
                    this.isPlaying = true;
                    this.updatePlayButton();
                    this.showMessage(`正在播放: ${track.name}`, 'success');
                }).catch(error => {
                    console.error('播放失败:', error);
                    this.showMessage('播放失败，请检查音频文件', 'error');
                });
            }

            togglePlayPause() {
                if (this.currentIndex === -1) {
                    this.playTrack(0);
                    return;
                }

                if (this.isPlaying) {
                    this.audio.pause();
                    this.isPlaying = false;
                } else {
                    this.audio.play().then(() => {
                        this.isPlaying = true;
                    }).catch(error => {
                        console.error('播放失败:', error);
                        this.showMessage('播放失败', 'error');
                    });
                }
                
                this.updatePlayButton();
            }

            previousTrack() {
                if (this.playlist.length === 0) return;
                const newIndex = this.currentIndex <= 0 ? this.playlist.length - 1 : this.currentIndex - 1;
                this.playTrack(newIndex);
            }

            nextTrack() {
                if (this.playlist.length === 0) return;
                const newIndex = this.currentIndex >= this.playlist.length - 1 ? 0 : this.currentIndex + 1;
                this.playTrack(newIndex);
            }

            updateNowPlaying(track) {
                document.getElementById('current-track').textContent = track.name;
                document.getElementById('current-artist').textContent = `时长: ${this.formatTime(track.time_big * 60)}`;
            }

            updatePlayButton() {
                const btn = document.getElementById('play-pause-btn');
                const icon = btn.querySelector('i');
                icon.className = this.isPlaying ? 'ri-pause-line' : 'ri-play-line';
            }

            updatePlaylistUI() {
                document.querySelectorAll('.music-item').forEach((item, index) => {
                    const playIcon = item.querySelector('.play-icon');
                    const indicator = item.querySelector('.playing-indicator');
                    
                    if (index === this.currentIndex) {
                        item.style.background = 'linear-gradient(135deg, var(--secondary-color), var(--primary-color))';
                        playIcon.className = this.isPlaying ? 'ri-pause-line play-icon' : 'ri-play-line play-icon';
                        indicator.style.display = this.isPlaying ? 'block' : 'none';
                    } else {
                        item.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        playIcon.className = 'ri-play-line play-icon';
                        indicator.style.display = 'none';
                    }
                });
            }

            updateProgress() {
                const progress = (this.audio.currentTime / this.audio.duration) * 100;
                document.getElementById('progress-fill').style.width = `${progress}%`;
                document.getElementById('current-time').textContent = this.formatTime(this.audio.currentTime);
            }

            updateStats() {
                const totalTracks = this.playlist.length;
                const totalDuration = this.playlist.reduce((sum, track) => sum + (track.time_big * 60), 0);
                
                document.getElementById('total-tracks').textContent = totalTracks;
                document.getElementById('total-duration').textContent = this.formatTime(totalDuration);
                document.getElementById('current-index').textContent = this.currentIndex >= 0 ? this.currentIndex + 1 : '-';
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            showMessage(message, type = 'info') {
                // 创建消息元素
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}`;
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    max-width: 300px;
                    animation: slideInRight 0.3s ease-out;
                `;
                messageEl.textContent = message;
                
                document.body.appendChild(messageEl);
                
                // 3秒后自动移除
                setTimeout(() => {
                    messageEl.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            messageEl.parentNode.removeChild(messageEl);
                        }
                    }, 300);
                }, 3000);
            }

            showError(message) {
                const container = document.getElementById('music-container');
                container.innerHTML = `
                    <div class="message error" style="grid-column: 1 / -1;">
                        <i class="ri-error-warning-line" style="margin-right: 0.5rem;"></i>
                        ${message}
                    </div>
                `;
            }

            triggerAnimations() {
                const section = document.getElementById('music-section');
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    section.style.transition = 'all 0.6s ease-out';
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, 100);
            }
        }

        // 添加滑入滑出动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            new MusicPlayer();
        });
    </script>
</body>
</html>