<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件下载 - huluobuo.github.io</title>
    <link rel="stylesheet" href="../styles.min.css">
    <meta name="description" content="文件下载中心 - 获取各种实用工具和资源">
    <style>
        /* 加载动画样式 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        .loading-container {
            text-align: center;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 1.2em;
            color: #333;
        }
        .content-hidden {
            display: none;
        }
        /* 文件页面样式 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        .icon-download::before { content: "📁"; }
        .icon-search::before { content: "🔍"; }
        .icon-file::before { content: "📄"; }
        .icon-arrow::before { content: "←"; }

        /* 修改GitHub图片悬停效果 */
        .header-content img:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(59,130,246,0.5);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-container">
            <div class="spinner"></div>
            <div class="loading-text">文件列表加载中，请稍候...</div>
        </div>
    </div>

    <!-- 主内容区域 -->
    <div class="content-hidden" id="mainContent">
        <header class="header">
            <div class="header-content">
                <a href="/">
                    <h1>huluobuo.github.io</h1>
                </a>
                <a href="https://github.com/huluobuo" target="_blank" rel="noopener noreferrer" class="tooltip" data-tooltip="访问我的GitHub">
                    <img src="../img/github_logo.png" alt="GitHub" width="32" height="32">
                </a>
            </div>
        </header>

        <main class="content">
            <section class="files-section" id="files-section">
                <h2><span class="icon-download" style="margin-right: 0.5rem;"></span>文件下载中心</h2>
                <p style="margin-bottom: 2rem; color: var(--gray-600);">我认为比较好的东西。</p>
                


                <div class="links-container" id="files-container">
                    <p style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--gray-600);">正在加载文件列表...</p>
                </div>
            </section>
        </main>

        <script src="../js/animations.js"></script>
        <script>
            class FileManager {
                constructor() {
                    this.files = [];
                    this.init();
                }

                async init() {
                    await this.loadFileList();
                    this.triggerAnimations();
                }

                async loadFileList() {
                    try {
                        const response = await fetch('filelist.json');
                        if (!response.ok) throw new Error('Failed to load file list');
                        
                        this.files = await response.json();
                        this.filteredFiles = [...this.files];
                        this.renderFiles();
                    } catch (error) {
                        console.error('加载文件列表时出错:', error);
                        this.showError('无法加载文件列表，请稍后重试。');
                    }
                }

                renderFiles() {
                    const container = document.getElementById('files-container');
                    
                    container.innerHTML = this.files.map((file, index) => `
                        <div class="link-box file-item" 
                           style="animation-delay: ${index * 0.1}s; cursor: pointer;"
                           data-file-name="${file.name.toLowerCase()}"
                           data-file-size="${file.size}"
                           data-file-path="${encodeURIComponent(file.path)}">
                            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                                <span class="icon-file" style="font-size: 2rem; margin-right: 0.75rem; opacity: 0.8;"></span>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0; font-size: 1.1rem; line-height: 1.3;">${file.name}</h3>
                                    <p style="margin: 0.25rem 0; font-size: 0.875rem; color: var(--gray-600);">${file.description || '暂无描述'}</p>
                                    <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.25rem;">
                                        <span>${file.size}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: auto;">
                                <span style="font-size: 0.875rem; opacity: 0.8;">点击下载</span>
                                <span style="font-size: 1.25rem;">⬇</span>
                            </div>
                        </div>
                    `).join('');

                    // 添加直接下载事件
                    this.addDirectDownloadEvents();
                }

                addDirectDownloadEvents() {
                    document.querySelectorAll('.file-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            const filePath = item.dataset.filePath;
                            
                            // 添加下载动画
                            const downloadIcon = item.querySelector('span:last-child');
                            // 使用正确的属性选择器匹配文件大小元素
                            const fileSizeElement = item.querySelector('div[style*="font-size: 0.875rem"][style*="opacity: 0.8"][style*="margin-top: 0.25rem"] span');
                            const originalFileSize = fileSizeElement.textContent;
                            
                            // 更改图标和隐藏文件大小
                            downloadIcon.textContent = '⏳';
                            fileSizeElement.textContent = '下载中...';
                            
                            // 直接创建下载链接
                            const link = document.createElement('a');
                            link.href = decodeURIComponent(filePath);
                            link.download = '';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            
                            // 触发下载
                            link.click();
                            document.body.removeChild(link);
                              
                            // 使用较长的延迟来确保下载完成后恢复图标和文件大小
                            // 对于大文件，用户可能需要等待更长时间，但最终会恢复
                            setTimeout(() => {
                                // 恢复图标
                                downloadIcon.textContent = '⬇';
                                
                                // 恢复文件大小显示
                                fileSizeElement.textContent = originalFileSize;
                                
                                // 显示下载成功提示
                                this.showDownloadSuccess(item);
                            }, 1500);
                        });
                    });
                }

                showDownloadSuccess(item) {
                    // 创建成功提示
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: var(--success-color);
                        color: white;
                        padding: 0.5rem 1rem;
                        border-radius: var(--border-radius);
                        font-size: 0.875rem;
                        z-index: 1000;
                        animation: fadeInOut 2s ease-in-out;
                    `;
                    successMsg.textContent = '下载已开始';
                    
                    // 添加动画样式
                    if (!document.getElementById('download-animation-style')) {
                        const style = document.createElement('style');
                        style.id = 'download-animation-style';
                        style.textContent = `
                            @keyframes fadeInOut {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                                50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                            }
                        `;
                        document.head.appendChild(style);
                    }
                    
                    item.style.position = 'relative';
                    item.appendChild(successMsg);
                    
                    // 2秒后移除提示
                    setTimeout(() => {
                        if (successMsg.parentNode) {
                            successMsg.parentNode.removeChild(successMsg);
                        }
                    }, 2000);
                }

                showError(message) {
                    const container = document.getElementById('files-container');
                    container.innerHTML = `
                        <div class="message error" style="grid-column: 1 / -1;">
                            <i class="ri-error-warning-line" style="margin-right: 0.5rem;"></i>
                            ${message}
                        </div>
                    `;
                }

                triggerAnimations() {
                    // 添加文件项动画
                    document.querySelectorAll('.file-item').forEach((item, index) => {
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        }, 100 * index);
                    });
                }
            }

            // 页面加载完成后初始化并隐藏加载动画
            window.addEventListener('load', function() {
                setTimeout(function() {
                    // 初始化文件管理器
                    const fileManager = new FileManager();

                    // 隐藏加载动画
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    const mainContent = document.getElementById('mainContent');

                    loadingOverlay.style.opacity = '0';
                    loadingOverlay.style.pointerEvents = 'none';
                    mainContent.classList.remove('content-hidden');

                    setTimeout(function() {
                        loadingOverlay.style.display = 'none';
                    }, 500);
                }, 500);
            });
        </script>
    </div>
</body>
</html>