<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶ä¸‹è½½ - huluobuo.github.io</title>
    <link rel="stylesheet" href="../styles.min.css">
    <meta name="description" content="æ–‡ä»¶ä¸‹è½½ä¸­å¿ƒ - è·å–å„ç§å®ç”¨å·¥å…·å’Œèµ„æº">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        .icon-download::before { content: "ğŸ“"; }
        .icon-search::before { content: "ğŸ”"; }
        .icon-file::before { content: "ğŸ“„"; }
        .icon-arrow::before { content: "â†"; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/">
                <h1>huluobuo.github.io</h1>
            </a>
            <a href="https://github.com/huluobuo" target="_blank" rel="noopener noreferrer" class="tooltip" data-tooltip="è®¿é—®æˆ‘çš„GitHub">
                <img src="../img/github_logo.png" alt="GitHub" width="32" height="32">
            </a>
        </div>
    </header>

    <main class="content">
        <section class="files-section" id="files-section">
            <h2><span class="icon-download" style="margin-right: 0.5rem;"></span>æ–‡ä»¶ä¸‹è½½ä¸­å¿ƒ</h2>
            <p style="margin-bottom: 2rem; color: var(--gray-600);">è¿™é‡Œæä¾›å„ç§å®ç”¨å·¥å…·å’Œèµ„æºçš„ä¸‹è½½ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ç»è¿‡å®‰å…¨æ£€æŸ¥ã€‚</p>
            
            <div class="search-container" style="margin-bottom: 2rem;">
                <div style="position: relative;">
                    <input type="text" id="search-input" placeholder="æœç´¢æ–‡ä»¶..." 
                           style="width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 2px solid var(--gray-200); border-radius: var(--border-radius); font-size: 1rem; transition: var(--transition);">
                    <span class="icon-search" style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--gray-400);"></span>
                </div>
            </div>

            <div class="files-stats" style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color: white; padding: 1rem; border-radius: var(--border-radius); flex: 1; min-width: 150px;">
                    <div style="font-size: 1.5rem; font-weight: 700;" id="total-files">0</div>
                    <div style="font-size: 0.875rem; opacity: 0.9;">æ€»æ–‡ä»¶æ•°</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary-color), var(--primary-color)); color: white; padding: 1rem; border-radius: var(--border-radius); flex: 1; min-width: 150px;">
                    <div style="font-size: 1.5rem; font-weight: 700;" id="total-size">0 KB</div>
                    <div style="font-size: 0.875rem; opacity: 0.9;">æ€»å¤§å°</div>
                </div>
            </div>

            <div class="links-container" id="files-container">
                <p style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--gray-600);">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...</p>
            </div>
        </section>
    </main>

    <script>
        class FileManager {
            constructor() {
                this.files = [];
                this.filteredFiles = [];
                this.init();
            }

            async init() {
                await this.loadFileList();
                this.setupSearch();
                this.updateStats();
                this.triggerAnimations();
            }

            async loadFileList() {
                try {
                    const response = await fetch('filelist.json');
                    if (!response.ok) throw new Error('Failed to load file list');
                    
                    this.files = await response.json();
                    this.filteredFiles = [...this.files];
                    this.renderFiles();
                } catch (error) {
                    console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨æ—¶å‡ºé”™:', error);
                    this.showError('æ— æ³•åŠ è½½æ–‡ä»¶åˆ—è¡¨ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                }
            }

            renderFiles() {
                const container = document.getElementById('files-container');
                
                if (this.filteredFiles.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                            <i class="ri-file-search-line" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <p style="color: var(--gray-600);">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredFiles.map((file, index) => `
                    <a href="download.html?file=${encodeURIComponent(file.path)}" 
                       class="link-box file-item" 
                       style="animation-delay: ${index * 0.1}s;"
                       data-file-name="${file.name.toLowerCase()}"
                       data-file-size="${file.size}">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span class="icon-file" style="font-size: 2rem; margin-right: 0.75rem; opacity: 0.8;"></span>
                            <div style="flex: 1;">
                                <h3 style="margin: 0; font-size: 1.1rem; line-height: 1.3;">${file.name}</h3>
                                <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.25rem;">
                                    <span>${file.size}</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: auto;">
                            <span style="font-size: 0.875rem; opacity: 0.8;">ç‚¹å‡»ä¸‹è½½</span>
                            <span style="font-size: 1.25rem;">â¬‡</span>
                        </div>
                    </a>
                `).join('');

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                this.addDownloadEvents();
            }

            addDownloadEvents() {
                document.querySelectorAll('.file-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        // æ·»åŠ ä¸‹è½½åŠ¨ç”»
                        const downloadIcon = item.querySelector('span:last-child');
                        downloadIcon.textContent = 'â³';
                        
                        // å»¶è¿Ÿè·³è½¬ä»¥æ˜¾ç¤ºåŠ¨ç”»
                        setTimeout(() => {
                            window.location.href = item.href;
                        }, 500);
                    });
                });
            }

            setupSearch() {
                const searchInput = document.getElementById('search-input');
                
                searchInput.addEventListener('input', utils.debounce((e) => {
                    const query = e.target.value.toLowerCase().trim();
                    
                    if (query === '') {
                        this.filteredFiles = [...this.files];
                    } else {
                        this.filteredFiles = this.files.filter(file => 
                            file.name.toLowerCase().includes(query)
                        );
                    }
                    
                    this.renderFiles();
                    this.updateStats();
                }, 300));

                // æœç´¢æ¡†ç„¦ç‚¹æ•ˆæœ
                searchInput.addEventListener('focus', () => {
                    searchInput.style.borderColor = 'var(--primary-color)';
                    searchInput.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
                });

                searchInput.addEventListener('blur', () => {
                    searchInput.style.borderColor = 'var(--gray-200)';
                    searchInput.style.boxShadow = 'none';
                });
            }

            updateStats() {
                const totalFiles = this.filteredFiles.length;
                const totalSizeKB = this.filteredFiles.reduce((sum, file) => {
                    const sizeMatch = file.size.match(/(\d+(?:\.\d+)?)\s*([KMG]?B?)/i);
                    if (sizeMatch) {
                        const value = parseFloat(sizeMatch[1]);
                        const unit = sizeMatch[2].toUpperCase();
                        switch (unit) {
                            case 'GB': return sum + (value * 1024 * 1024);
                            case 'MB': return sum + (value * 1024);
                            case 'KB': case 'K': return sum + value;
                            default: return sum + (value / 1024);
                        }
                    }
                    return sum;
                }, 0);

                document.getElementById('total-files').textContent = totalFiles;
                document.getElementById('total-size').textContent = utils.formatFileSize(totalSizeKB * 1024);
            }

            showError(message) {
                const container = document.getElementById('files-container');
                container.innerHTML = `
                    <div class="message error" style="grid-column: 1 / -1;">
                        <i class="ri-error-warning-line" style="margin-right: 0.5rem;"></i>
                        ${message}
                    </div>
                `;
            }

            triggerAnimations() {
                const section = document.getElementById('files-section');
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    section.style.transition = 'all 0.6s ease-out';
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, 100);
            }
        }

        // å·¥å…·å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        const utils = {
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new FileManager();
        });
    </script>
</body>
</html>